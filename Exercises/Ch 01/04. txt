See convert.cpp for implementation.